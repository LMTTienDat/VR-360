{"ast":null,"code":"/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nvar vec4 = require('gl-matrix').vec4;\nvar mat4 = require('gl-matrix').mat4;\n\n/**\n * Helper functions for color transformation {@link Effects}.\n *\n * References:\n *\n *   - [ColorMatrix Guide](http://docs.rainmeter.net/tips/colormatrix-guide)\n *   - [Matrix Operations for Image Processing](http://www.graficaobscura.com/matrix/index.html)\n *   - [WebGLImageFilter](https://github.com/phoboslab/WebGLImageFilter)\n *   - [glfx.js](https://github.com/evanw/glfx.js)\n *\n * @namespace colorEffects\n */\n\n/**\n * A vector and matrix corresponding to an identity transformation.\n *\n * @param {Object} result Object to store result\n * @param {vec4} result.colorOffset Array with zeroes.\n * @param {mat4} result.colorMatrix Identity matrix.\n *\n * @memberof colorEffects\n */\nfunction identity(resultArg) {\n  var result = resultArg || {};\n  result.colorOffset = result.colorOffset || vec4.create();\n  result.colorMatrix = result.colorMatrix || mat4.create();\n  return result;\n}\n\n/**\n * Apply color effects to a single pixel\n *\n * @param {vec4} pixel Values in range [0,1]\n * @param {Object} effect\n * @param {vec4} effect.colorOffset\n * @param {mat4} effect.colorMatrix\n * @param {vec4} result Object to store result\n *\n * @memberof colorEffects\n */\nfunction applyToPixel(pixel, effect, result) {\n  vec4TransformMat4Transposed(result, pixel, effect.colorMatrix);\n  vec4.add(result, result, effect.colorOffset);\n}\n\n// Oddly, the colorTransform matrix needs to be transposed to be used with\n// vec4.transformMat4. It is strange that transformMat4 dosn't work the same\n// way as multiplying on the shader.\n// TODO: investigate this further\nfunction vec4TransformMat4Transposed(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2],\n    w = a[3];\n  out[0] = m[0] * x + m[1] * y + m[2] * z + m[3] * w;\n  out[1] = m[4] * x + m[5] * y + m[6] * z + m[7] * w;\n  out[2] = m[8] * x + m[9] * y + m[10] * z + m[11] * w;\n  out[3] = m[12] * x + m[13] * y + m[14] * z + m[15] * w;\n  return out;\n}\n\n/**\n * Apply color effects to an ImageData\n *\n * @param {ImageData} imageData This object will be mutated\n * @param {Object} effect\n * @param {vec4} effect.colorOffset\n * @param {mat4} effect.colorMatrix\n *\n * @memberof colorEffects\n */\nvar tmpPixel = vec4.create();\nfunction applyToImageData(imageData, effect) {\n  var width = imageData.width;\n  var height = imageData.height;\n  var data = imageData.data;\n  for (var i = 0; i < width * height; i++) {\n    vec4.set(tmpPixel, data[i * 4 + 0] / 255, data[i * 4 + 1] / 255, data[i * 4 + 2] / 255, data[i * 4 + 3] / 255);\n    applyToPixel(tmpPixel, effect, tmpPixel);\n    data[i * 4 + 0] = tmpPixel[0] * 255;\n    data[i * 4 + 1] = tmpPixel[1] * 255;\n    data[i * 4 + 2] = tmpPixel[2] * 255;\n    data[i * 4 + 3] = tmpPixel[3] * 255;\n  }\n}\nmodule.exports = {\n  identity: identity,\n  applyToPixel: applyToPixel,\n  applyToImageData: applyToImageData\n};","map":{"version":3,"names":["vec4","require","mat4","identity","resultArg","result","colorOffset","create","colorMatrix","applyToPixel","pixel","effect","vec4TransformMat4Transposed","add","out","a","m","x","y","z","w","tmpPixel","applyToImageData","imageData","width","height","data","i","set","module","exports"],"sources":["E:/VR/node_modules/marzipano/src/colorEffects.js"],"sourcesContent":["/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nvar vec4 = require('gl-matrix').vec4;\nvar mat4 = require('gl-matrix').mat4;\n\n/**\n * Helper functions for color transformation {@link Effects}.\n *\n * References:\n *\n *   - [ColorMatrix Guide](http://docs.rainmeter.net/tips/colormatrix-guide)\n *   - [Matrix Operations for Image Processing](http://www.graficaobscura.com/matrix/index.html)\n *   - [WebGLImageFilter](https://github.com/phoboslab/WebGLImageFilter)\n *   - [glfx.js](https://github.com/evanw/glfx.js)\n *\n * @namespace colorEffects\n */\n\n/**\n * A vector and matrix corresponding to an identity transformation.\n *\n * @param {Object} result Object to store result\n * @param {vec4} result.colorOffset Array with zeroes.\n * @param {mat4} result.colorMatrix Identity matrix.\n *\n * @memberof colorEffects\n */\nfunction identity(resultArg) {\n  var result = resultArg || {};\n  result.colorOffset = result.colorOffset || vec4.create();\n  result.colorMatrix = result.colorMatrix || mat4.create();\n  return result;\n}\n\n/**\n * Apply color effects to a single pixel\n *\n * @param {vec4} pixel Values in range [0,1]\n * @param {Object} effect\n * @param {vec4} effect.colorOffset\n * @param {mat4} effect.colorMatrix\n * @param {vec4} result Object to store result\n *\n * @memberof colorEffects\n */\nfunction applyToPixel(pixel, effect, result) {\n  vec4TransformMat4Transposed(result, pixel, effect.colorMatrix);\n  vec4.add(result, result, effect.colorOffset);\n}\n\n// Oddly, the colorTransform matrix needs to be transposed to be used with\n// vec4.transformMat4. It is strange that transformMat4 dosn't work the same\n// way as multiplying on the shader.\n// TODO: investigate this further\nfunction vec4TransformMat4Transposed(out, a, m) {\n  var x = a[0], y = a[1], z = a[2], w = a[3];\n  out[0] = m[0] * x + m[1] * y + m[2] * z + m[3] * w;\n  out[1] = m[4] * x + m[5] * y + m[6] * z + m[7] * w;\n  out[2] = m[8] * x + m[9] * y + m[10] * z + m[11] * w;\n  out[3] = m[12] * x + m[13] * y + m[14] * z + m[15] * w;\n  return out;\n}\n\n/**\n * Apply color effects to an ImageData\n *\n * @param {ImageData} imageData This object will be mutated\n * @param {Object} effect\n * @param {vec4} effect.colorOffset\n * @param {mat4} effect.colorMatrix\n *\n * @memberof colorEffects\n */\nvar tmpPixel = vec4.create();\nfunction applyToImageData(imageData, effect) {\n  var width = imageData.width;\n  var height = imageData.height;\n  var data = imageData.data;\n\n  for(var i = 0; i < width * height; i++) {\n    vec4.set(tmpPixel, data[i*4+0]/255, data[i*4+1]/255, data[i*4+2]/255, data[i*4+3]/255);\n    applyToPixel(tmpPixel, effect, tmpPixel);\n    data[i*4+0] = tmpPixel[0]*255;\n    data[i*4+1] = tmpPixel[1]*255;\n    data[i*4+2] = tmpPixel[2]*255;\n    data[i*4+3] = tmpPixel[3]*255;\n  }\n}\n\nmodule.exports = {\n  identity: identity,\n  applyToPixel: applyToPixel,\n  applyToImageData: applyToImageData\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}